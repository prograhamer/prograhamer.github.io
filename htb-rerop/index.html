<!doctype html><html lang=en><head><meta charset=utf-8><meta content="width=device-width,initial-scale=1" name=viewport><title>
    
    Hack The Box - ReRop -
    
    PinkFalcon
  </title><link href="https://pinkfalcon.ca/base.css?h=cc73157e5a7cb133d350" rel=stylesheet><link title="RSS Feed" href=https://pinkfalcon.ca/rss.xml rel=alternate type=application/rss+xml><link title="Atom Feed" href=https://pinkfalcon.ca/atom.xml rel=alternate type=application/atom+xml><meta content="Hack The Box - ReRop - PinkFalcon" property=og:title><meta content='A write-up for the Hack The Box reverse engineering challenge "ReRop"' property=og:description><meta content=article property=og:type><meta content=https://pinkfalcon.ca/htb-rerop property=og:url><meta context=2024-10-06 property=og:article:published_time><body><div class=gradient><div class=falcon><img role=presentation src=/images/falcon.png></div></div><div class=content><header><h1 class=title>Hack The Box - ReRop</h1><div><div class=skiplink><a href=#content>Skip to main content</a></div><div class=subtitle><div class=description>A write-up for the Hack The Box reverse engineering challenge "ReRop"</div><div class=date>2024-10-06</div></div><nav aria-label=categories><ul class=categories><li><a href=https://pinkfalcon.ca/categories/hack-the-box/>Hack The Box</a><li><a href=https://pinkfalcon.ca/categories/reversing/>Reversing</a></ul></nav></div></header><main id=content><h2 id=introduction>Introduction</h2><p>The zip archive downloaded from Hack The Box contains a single file: a Linux x86_64 executable named <code>rerop</code>. The file is not stripped, so we get quite a lot of help from symbol names. It also isn't position independent, so we know the various sections from the binary will be loaded at addresses determined at compile time and not run time. This will become important later.<p>The <code>main</code> function is extremely simple in appearance:<ul><li>call <code>printf</code> to print a prompt to enter the flag<li>call <code>fgets</code> read user input into a static buffer <code>buf</code> (in the <code>.data</code> section)<li>call <code>strcspn</code> to find the first newline character, then strip it from the user input<li>call a function <code>check</code>, passing in <code>data</code> (another symbol in the <code>.data</code> section)<li>call <code>puts(buf)</code> to print out the user input (possibly modified by <code>check</code>)</ul><p>This leaves the <code>check</code> function as the most likely source of interest, both from its name and the absence of anything else interesting happening in <code>main</code>.<h2 id=the-check-function>The <code>check</code> function</h2><p>Looking into the <code>check</code> function, the Ghidra decompilation output is very misleading, and just shows the following:<pre class="language-c z-code" data-lang=c><code class=language-c data-lang=c><span class="z-source z-c"><span class="z-storage z-type z-c">void</span> <span class="z-meta z-function z-c"><span class="z-entity z-name z-function z-c">check</span></span><span class="z-meta z-function z-parameters z-c"><span class="z-meta z-group z-c"><span class="z-punctuation z-section z-group z-begin z-c">(</span></span></span><span class="z-meta z-function z-parameters z-c"><span class="z-meta z-group z-c"><span class="z-storage z-type z-c">void</span><span class="z-punctuation z-section z-group z-end z-c">)</span></span></span><span class="z-meta z-function z-c">
</span></span><span class="z-source z-c"><span class="z-meta z-function z-c"></span><span class="z-meta z-function z-c"><span class="z-meta z-block z-c"><span class="z-punctuation z-section z-block z-begin z-c">{</span></span></span><span class="z-meta z-function z-c"><span class="z-meta z-block z-c">
</span></span></span><span class="z-source z-c"><span class="z-meta z-function z-c"><span class="z-meta z-block z-c">  <span class="z-keyword z-control z-flow z-return z-c">return</span><span class="z-punctuation z-terminator z-c">;</span>
</span></span></span><span class="z-source z-c"><span class="z-meta z-function z-c"><span class="z-meta z-block z-c"></span></span><span class="z-meta z-function z-c"><span class="z-meta z-block z-c"><span class="z-punctuation z-section z-block z-end z-c">}</span></span></span>
</span></code></pre><p>This is a case where decompilation can't really do much, because the function's implementation can't really be expressed in C. Examining the disassembly is much more illuminating:<pre class="language-asm z-code" data-lang=asm><code class=language-asm data-lang=asm><span class="z-source z-assembly"><span class="z-entity z-name z-function z-assembly">e</span><span class="z-entity z-name z-function z-assembly">n</span><span class="z-entity z-name z-function z-assembly">d</span><span class="z-entity z-name z-function z-assembly">b</span><span class="z-entity z-name z-function z-assembly">r</span><span class="z-entity z-name z-function z-assembly">6</span><span class="z-entity z-name z-function z-assembly">4</span>
</span><span class="z-source z-assembly"><span class="z-keyword z-control z-assembly">lea</span><span class="z-entity z-name z-function z-assembly"> </span><span class="z-entity z-name z-function z-assembly">%</span><span class="z-entity z-name z-function z-assembly">(</span><span class="z-variable z-parameter z-register z-assembly">rdi</span><span class="z-entity z-name z-function z-assembly">)</span><span class="z-source z-assembly">,</span><span class="z-entity z-name z-function z-assembly"> </span><span class="z-entity z-name z-function z-assembly">%</span><span class="z-variable z-parameter z-register z-assembly">rsp</span><span class="z-comment z-assembly"> ; Intel: LEA RSP, [RDI]</span>
</span><span class="z-source z-assembly"><span class="z-keyword z-control z-assembly">ret</span>
</span></code></pre><p>This function does do something a lot more significant than just returning, it replaces the stack pointer with the address passed in as the first argument. Reflecting on the challenge name, this makes a lot of sense, as this looks a lot like a stack pivot to set up a <abbr title="Return-Oriented Programming">ROP</abbr><sup class=footnote-reference><a href=#rop>1</a></sup> chain.<h2 id=return-oriented-programming>Return-oriented Programming</h2><p>It seems reasonable to give a quick overview of return-oriented programming here, before moving on with this write-up, for the sake of completeness.<p>In return-oriented programming, either the stack is overwritten, or the stack pointer itself is altered, to have the return pointer of a stack frame point to a so-called gadget. These gadgets are usually desired to be a short sequence of instructions to achieve a specific purpose, e.g. popping a value from the stack into a register, followed by a <code>ret</code> instruction. Because the stack is controlled, this means the return pointer used by the <code>ret</code> from a gadget can also be controlled, giving a way of executing an arbitrary chain of instructions only using the code that already exists within an executable.<p>This technique can be useful to bypass the non-executable stack protection that prevents an attacker from simply writing a shellcode to the stack and overwriting the return pointer of the current stack frame to jump into that shellcode. Since return-oriented programming only relies on execution of code that is already part of the program being hijacked, and that code must be executable for the program to work, this technique provides an elegant bypass for one of the early mitigations created against turning stack-based buffer overflows into arbitrary code execution.<p>In the case of the <code>rerop</code> executable, the stack pointer is modified to pointer instead to some static data contained in the binary's <code>.data</code> section. We can analyze this data to establish the actual code execution by treating any <code>pop</code> instruction as consuming data from the "stack", and treating <code>ret</code> as special case of <code>pop %rip</code>.<h2 id=linearizing-the-rop-chain>Linearizing the ROP Chain</h2><p>What we have in the stack, after the pivot to the address of the <code>data</code> symbol, is something like the following (truncated to match up with a functional block as shown later):<pre class=z-code><code><span class="z-text z-plain">0x4c5100: 0x450ec7
</span><span class="z-text z-plain">0x4c5108: 0x000065
</span><span class="z-text z-plain">0x4c5110: 0x401eef
</span><span class="z-text z-plain">0x4c5118: 0x000000
</span><span class="z-text z-plain">0x4c5120: 0x409f1e
</span><span class="z-text z-plain">0x4c5128: 0x000001
</span><span class="z-text z-plain">0x4c5130: 0x458142
</span><span class="z-text z-plain">0x4c5138: 0x000000
</span><span class="z-text z-plain">0x4c5140: 0x41aab6
</span><span class="z-text z-plain">0x4c5148: 0x451fe0
</span><span class="z-text z-plain">0x4c5150: 0x450ec7
</span><span class="z-text z-plain">0x4c5158: 0x001198
</span><span class="z-text z-plain">0x4c5160: 0x452000
</span></code></pre><p>The structure of this is fairly simple, it's a list of return pointers interlaced with data that is consumed from the stack by the instructions referenced by the return address, before that sequence of instructions invokes another return. E.g. the instructions at <code>0x450ec7</code> (the first return pointer) are <code>pop %rax; ret</code>, so the first gadget sets <code>rax</code> equal to <code>0x65</code> (since that is the next entry on the stack after the return address).<p>What I'd like to see is the actual instructions executed at each return address, in sequence, including the register assignments using <code>pop</code> instructions. In order to achieve this, without having to manually reference every return address, I wrote a short python script to "linearize" the chain into a more comprehensible form. The program I came up with is below. It loads the binary using <code>ELF</code> class from <a rel="nofollow noreferrer" href=https://github.com/Gallopsled/pwntools>pwntools</a> to allow looking up data for symbols and from arbitrary addresses in the binary. It uses the same disassembly library (<a rel="nofollow noreferrer" href=https://github.com/icedland/iced>iced_x86</a>) as I used in the <a href=https://pinkfalcon.ca/htb-ptrace-nopeeking/>PTRACE_NOPEEKING</a> challenge.<pre class="language-python z-code" data-lang=python><code class=language-python data-lang=python><span class="z-source z-python"><span class="z-comment z-line z-number-sign z-python"><span class="z-punctuation z-definition z-comment z-python">#</span>!/usr/bin/env python3
</span></span><span class="z-source z-python">
</span><span class="z-source z-python"><span class="z-meta z-statement z-import z-python"><span class="z-keyword z-control z-import z-from z-python">from</span></span><span class="z-meta z-statement z-import z-python"><span class="z-meta z-import-source z-python"> <span class="z-meta z-import-path z-python"><span class="z-meta z-import-name z-python">iced_x86</span></span> <span class="z-meta z-statement z-import z-python"><span class="z-keyword z-control z-import z-python">import</span></span></span></span><span class="z-meta z-statement z-import z-python"></span><span class="z-meta z-statement z-import z-python"> <span class="z-meta z-generic-name z-python">Decoder</span><span class="z-punctuation z-separator z-import-list z-python">,</span> <span class="z-meta z-generic-name z-python">Formatter</span><span class="z-punctuation z-separator z-import-list z-python">,</span> <span class="z-meta z-generic-name z-python">FormatterSyntax</span><span class="z-punctuation z-separator z-import-list z-python">,</span> <span class="z-meta z-generic-name z-python">Mnemonic</span><span class="z-punctuation z-separator z-import-list z-python">,</span> <span class="z-meta z-generic-name z-python">OpCodeOperandKind</span></span>
</span><span class="z-source z-python">
</span><span class="z-source z-python"><span class="z-meta z-statement z-import z-python"><span class="z-keyword z-control z-import z-from z-python">from</span></span><span class="z-meta z-statement z-import z-python"><span class="z-meta z-import-source z-python"> <span class="z-meta z-import-path z-python"><span class="z-meta z-import-name z-python">pwnlib</span><span class="z-punctuation z-accessor z-dot z-python">.</span><span class="z-meta z-import-name z-python">elf</span><span class="z-punctuation z-accessor z-dot z-python">.</span><span class="z-meta z-import-name z-python">elf</span></span> <span class="z-meta z-statement z-import z-python"><span class="z-keyword z-control z-import z-python">import</span></span></span></span><span class="z-meta z-statement z-import z-python"></span><span class="z-meta z-statement z-import z-python"> <span class="z-variable z-other z-constant z-python">ELF</span></span>
</span><span class="z-source z-python"><span class="z-meta z-statement z-import z-python"><span class="z-keyword z-control z-import z-from z-python">from</span></span><span class="z-meta z-statement z-import z-python"><span class="z-meta z-import-source z-python"> <span class="z-meta z-import-path z-python"><span class="z-meta z-import-name z-python">pwnlib</span><span class="z-punctuation z-accessor z-dot z-python">.</span><span class="z-meta z-import-name z-python">util</span><span class="z-punctuation z-accessor z-dot z-python">.</span><span class="z-meta z-import-name z-python">packing</span></span> <span class="z-meta z-statement z-import z-python"><span class="z-keyword z-control z-import z-python">import</span></span></span></span><span class="z-meta z-statement z-import z-python"></span><span class="z-meta z-statement z-import z-python"> <span class="z-meta z-generic-name z-python">u64</span></span>
</span><span class="z-source z-python">
</span><span class="z-source z-python"><span class="z-meta z-function z-python"><span class="z-storage z-type z-function z-python"><span class="z-keyword z-declaration z-function z-python">def</span></span> <span class="z-entity z-name z-function z-python"><span class="z-meta z-generic-name z-python">main</span></span></span><span class="z-meta z-function z-parameters z-python"><span class="z-punctuation z-section z-parameters z-begin z-python">(</span></span><span class="z-meta z-function z-parameters z-python"><span class="z-punctuation z-section z-parameters z-end z-python">)</span></span><span class="z-meta z-function z-python"><span class="z-punctuation z-section z-function z-begin z-python">:</span></span>
</span><span class="z-source z-python">    <span class="z-meta z-qualified-name z-python"><span class="z-meta z-generic-name z-python">formatter</span></span> <span class="z-keyword z-operator z-assignment z-python">=</span> <span class="z-meta z-function-call z-python"><span class="z-meta z-qualified-name z-python"><span class="z-variable z-function z-python"><span class="z-meta z-generic-name z-python">Formatter</span></span></span></span><span class="z-meta z-function-call z-arguments z-python"><span class="z-punctuation z-section z-arguments z-begin z-python">(</span><span class="z-meta z-qualified-name z-python"><span class="z-meta z-generic-name z-python">FormatterSyntax</span><span class="z-punctuation z-accessor z-dot z-python">.</span><span class="z-variable z-other z-constant z-python">GAS</span></span><span class="z-punctuation z-section z-arguments z-end z-python">)</span></span>
</span><span class="z-source z-python">    <span class="z-meta z-qualified-name z-python"><span class="z-meta z-generic-name z-python">formatter</span><span class="z-punctuation z-accessor z-dot z-python">.</span><span class="z-meta z-generic-name z-python">branch_leading_zeros</span></span> <span class="z-keyword z-operator z-assignment z-python">=</span> <span class="z-constant z-language z-python">False</span>
</span><span class="z-source z-python">    <span class="z-meta z-qualified-name z-python"><span class="z-meta z-generic-name z-python">formatter</span><span class="z-punctuation z-accessor z-dot z-python">.</span><span class="z-meta z-generic-name z-python">space_after_operand_separator</span></span> <span class="z-keyword z-operator z-assignment z-python">=</span> <span class="z-constant z-language z-python">True</span>
</span><span class="z-source z-python">
</span><span class="z-source z-python">    <span class="z-meta z-qualified-name z-python"><span class="z-meta z-generic-name z-python">elf</span></span> <span class="z-keyword z-operator z-assignment z-python">=</span> <span class="z-meta z-function-call z-python"><span class="z-meta z-qualified-name z-python"><span class="z-variable z-function z-python"><span class="z-meta z-generic-name z-python">ELF</span></span></span></span><span class="z-meta z-function-call z-arguments z-python"><span class="z-punctuation z-section z-arguments z-begin z-python">(</span><span class="z-meta z-string z-python"><span class="z-string z-quoted z-double z-python"><span class="z-punctuation z-definition z-string z-begin z-python">"</span></span></span><span class="z-meta z-string z-python"><span class="z-string z-quoted z-double z-python">rerop<span class="z-punctuation z-definition z-string z-end z-python">"</span></span></span><span class="z-punctuation z-section z-arguments z-end z-python">)</span></span>
</span><span class="z-source z-python">
</span><span class="z-source z-python">    <span class="z-comment z-line z-number-sign z-python"><span class="z-punctuation z-definition z-comment z-python">#</span> Initialize the stack pointer to the addres of `data`
</span></span><span class="z-source z-python">    <span class="z-meta z-qualified-name z-python"><span class="z-meta z-generic-name z-python">stack_pointer</span></span> <span class="z-keyword z-operator z-assignment z-python">=</span> <span class="z-meta z-item-access z-python"><span class="z-meta z-qualified-name z-python"><span class="z-meta z-generic-name z-python">elf</span><span class="z-punctuation z-accessor z-dot z-python">.</span><span class="z-meta z-generic-name z-python">sym</span></span></span><span class="z-meta z-item-access z-python"><span class="z-punctuation z-section z-brackets z-begin z-python">[</span></span><span class="z-meta z-item-access z-arguments z-python"><span class="z-meta z-string z-python"><span class="z-string z-quoted z-double z-python"><span class="z-punctuation z-definition z-string z-begin z-python">"</span></span></span><span class="z-meta z-string z-python"><span class="z-string z-quoted z-double z-python">data<span class="z-punctuation z-definition z-string z-end z-python">"</span></span></span></span><span class="z-meta z-item-access z-python"><span class="z-punctuation z-section z-brackets z-end z-python">]</span></span>
</span><span class="z-source z-python">
</span><span class="z-source z-python">    <span class="z-meta z-qualified-name z-python"><span class="z-meta z-generic-name z-python">valid</span></span> <span class="z-keyword z-operator z-assignment z-python">=</span> <span class="z-constant z-language z-python">True</span>
</span><span class="z-source z-python">
</span><span class="z-source z-python">    <span class="z-meta z-statement z-loop z-while z-python"><span class="z-keyword z-control z-loop z-while z-python">while</span> <span class="z-meta z-qualified-name z-python"><span class="z-meta z-generic-name z-python">valid</span></span><span class="z-punctuation z-section z-block z-loop z-while z-python">:</span></span>
</span><span class="z-source z-python">        <span class="z-comment z-line z-number-sign z-python"><span class="z-punctuation z-definition z-comment z-python">#</span> Get the current return address from the stack pointer,
</span></span><span class="z-source z-python">        <span class="z-meta z-qualified-name z-python"><span class="z-meta z-generic-name z-python">return_addr</span></span> <span class="z-keyword z-operator z-assignment z-python">=</span> <span class="z-meta z-function-call z-python"><span class="z-meta z-qualified-name z-python"><span class="z-variable z-function z-python"><span class="z-meta z-generic-name z-python">u64</span></span></span></span><span class="z-meta z-function-call z-arguments z-python"><span class="z-punctuation z-section z-arguments z-begin z-python">(</span><span class="z-meta z-function-call z-python"><span class="z-meta z-qualified-name z-python"><span class="z-meta z-generic-name z-python">elf</span></span><span class="z-meta z-qualified-name z-python"><span class="z-punctuation z-accessor z-dot z-python">.</span></span><span class="z-meta z-qualified-name z-python"><span class="z-variable z-function z-python"><span class="z-meta z-generic-name z-python">read</span></span></span></span><span class="z-meta z-function-call z-arguments z-python"><span class="z-punctuation z-section z-arguments z-begin z-python">(</span><span class="z-meta z-qualified-name z-python"><span class="z-meta z-generic-name z-python">stack_pointer</span></span><span class="z-punctuation z-separator z-arguments z-python">,</span> <span class="z-constant z-numeric z-integer z-decimal z-python">8</span><span class="z-punctuation z-section z-arguments z-end z-python">)</span></span><span class="z-punctuation z-section z-arguments z-end z-python">)</span></span>
</span><span class="z-source z-python">        <span class="z-comment z-line z-number-sign z-python"><span class="z-punctuation z-definition z-comment z-python">#</span> Imitate a `ret` by consuming the data from the stack
</span></span><span class="z-source z-python">        <span class="z-meta z-qualified-name z-python"><span class="z-meta z-generic-name z-python">stack_pointer</span></span> <span class="z-keyword z-operator z-assignment z-augmented z-python">+=</span> <span class="z-constant z-numeric z-integer z-decimal z-python">8</span>
</span><span class="z-source z-python">
</span><span class="z-source z-python">        <span class="z-comment z-line z-number-sign z-python"><span class="z-punctuation z-definition z-comment z-python">#</span> Read some data from the return address, 0x200 is arbitrary but proved plenty for this to work
</span></span><span class="z-source z-python">        <span class="z-meta z-qualified-name z-python"><span class="z-meta z-generic-name z-python">gadget</span></span> <span class="z-keyword z-operator z-assignment z-python">=</span> <span class="z-meta z-function-call z-python"><span class="z-meta z-qualified-name z-python"><span class="z-meta z-generic-name z-python">elf</span></span><span class="z-meta z-qualified-name z-python"><span class="z-punctuation z-accessor z-dot z-python">.</span></span><span class="z-meta z-qualified-name z-python"><span class="z-variable z-function z-python"><span class="z-meta z-generic-name z-python">read</span></span></span></span><span class="z-meta z-function-call z-arguments z-python"><span class="z-punctuation z-section z-arguments z-begin z-python">(</span><span class="z-meta z-qualified-name z-python"><span class="z-meta z-generic-name z-python">return_addr</span></span><span class="z-punctuation z-separator z-arguments z-python">,</span> <span class="z-constant z-numeric z-integer z-hexadecimal z-python"><span class="z-punctuation z-definition z-numeric z-base z-python">0x</span>200</span><span class="z-punctuation z-section z-arguments z-end z-python">)</span></span>
</span><span class="z-source z-python">
</span><span class="z-source z-python">        <span class="z-meta z-qualified-name z-python"><span class="z-meta z-generic-name z-python">decoder</span></span> <span class="z-keyword z-operator z-assignment z-python">=</span> <span class="z-meta z-function-call z-python"><span class="z-meta z-qualified-name z-python"><span class="z-variable z-function z-python"><span class="z-meta z-generic-name z-python">Decoder</span></span></span></span><span class="z-meta z-function-call z-arguments z-python"><span class="z-punctuation z-section z-arguments z-begin z-python">(</span><span class="z-constant z-numeric z-integer z-decimal z-python">64</span><span class="z-punctuation z-separator z-arguments z-python">,</span> <span class="z-meta z-qualified-name z-python"><span class="z-meta z-generic-name z-python">gadget</span></span><span class="z-punctuation z-separator z-arguments z-python">,</span> <span class="z-variable z-parameter z-python">ip</span><span class="z-keyword z-operator z-assignment z-python">=</span><span class="z-meta z-qualified-name z-python"><span class="z-meta z-generic-name z-python">return_addr</span></span><span class="z-punctuation z-section z-arguments z-end z-python">)</span></span>
</span><span class="z-source z-python">
</span><span class="z-source z-python">        <span class="z-meta z-statement z-loop z-for z-python"><span class="z-keyword z-control z-loop z-for z-python">for</span> <span class="z-meta z-generic-name z-python">instr</span> <span class="z-keyword z-control z-loop z-for z-in z-python">in</span></span><span class="z-meta z-statement z-loop z-for z-python"> <span class="z-meta z-qualified-name z-python"><span class="z-meta z-generic-name z-python">decoder</span></span></span><span class="z-meta z-statement z-loop z-for z-python"><span class="z-punctuation z-section z-block z-loop z-for z-python">:</span></span>
</span><span class="z-source z-python">            <span class="z-meta z-statement z-conditional z-if z-python"><span class="z-keyword z-control z-conditional z-if z-python">if</span> <span class="z-meta z-qualified-name z-python"><span class="z-meta z-generic-name z-python">instr</span><span class="z-punctuation z-accessor z-dot z-python">.</span><span class="z-meta z-generic-name z-python">mnemonic</span></span> <span class="z-keyword z-operator z-comparison z-python">==</span> <span class="z-meta z-qualified-name z-python"><span class="z-meta z-generic-name z-python">Mnemonic</span><span class="z-punctuation z-accessor z-dot z-python">.</span><span class="z-variable z-other z-constant z-python">INVALID</span></span><span class="z-punctuation z-section z-block z-conditional z-if z-python">:</span></span>
</span><span class="z-source z-python">                <span class="z-comment z-line z-number-sign z-python"><span class="z-punctuation z-definition z-comment z-python">#</span> Bail on encoutering the first invalid instruction
</span></span><span class="z-source z-python">                <span class="z-comment z-line z-number-sign z-python"><span class="z-punctuation z-definition z-comment z-python">#</span> Might be nicer to bail on `syscall` when %rax = 0x3c (exit), but this works just fine
</span></span><span class="z-source z-python">                <span class="z-meta z-qualified-name z-python"><span class="z-meta z-generic-name z-python">valid</span></span> <span class="z-keyword z-operator z-assignment z-python">=</span> <span class="z-constant z-language z-python">False</span>
</span><span class="z-source z-python">                <span class="z-keyword z-control z-flow z-break z-python">break</span>
</span><span class="z-source z-python">
</span><span class="z-source z-python">            <span class="z-meta z-qualified-name z-python"><span class="z-meta z-generic-name z-python">finstr</span></span> <span class="z-keyword z-operator z-assignment z-python">=</span> <span class="z-meta z-function-call z-python"><span class="z-meta z-qualified-name z-python"><span class="z-meta z-generic-name z-python">formatter</span></span><span class="z-meta z-qualified-name z-python"><span class="z-punctuation z-accessor z-dot z-python">.</span></span><span class="z-meta z-qualified-name z-python"><span class="z-variable z-function z-python"><span class="z-meta z-generic-name z-python">format</span></span></span></span><span class="z-meta z-function-call z-arguments z-python"><span class="z-punctuation z-section z-arguments z-begin z-python">(</span><span class="z-meta z-qualified-name z-python"><span class="z-meta z-generic-name z-python">instr</span></span><span class="z-punctuation z-section z-arguments z-end z-python">)</span></span>
</span><span class="z-source z-python">
</span><span class="z-source z-python">            <span class="z-meta z-statement z-conditional z-if z-python"><span class="z-keyword z-control z-conditional z-if z-python">if</span> <span class="z-meta z-qualified-name z-python"><span class="z-meta z-generic-name z-python">instr</span><span class="z-punctuation z-accessor z-dot z-python">.</span><span class="z-meta z-generic-name z-python">mnemonic</span></span> <span class="z-keyword z-operator z-comparison z-python">==</span> <span class="z-meta z-qualified-name z-python"><span class="z-meta z-generic-name z-python">Mnemonic</span><span class="z-punctuation z-accessor z-dot z-python">.</span><span class="z-variable z-other z-constant z-python">POP</span></span><span class="z-punctuation z-section z-block z-conditional z-if z-python">:</span></span>
</span><span class="z-source z-python">                <span class="z-comment z-line z-number-sign z-python"><span class="z-punctuation z-definition z-comment z-python">#</span> Get the data from the stack
</span></span><span class="z-source z-python">                <span class="z-meta z-qualified-name z-python"><span class="z-meta z-generic-name z-python">data</span></span> <span class="z-keyword z-operator z-assignment z-python">=</span> <span class="z-meta z-function-call z-python"><span class="z-meta z-qualified-name z-python"><span class="z-meta z-generic-name z-python">elf</span></span><span class="z-meta z-qualified-name z-python"><span class="z-punctuation z-accessor z-dot z-python">.</span></span><span class="z-meta z-qualified-name z-python"><span class="z-variable z-function z-python"><span class="z-meta z-generic-name z-python">read</span></span></span></span><span class="z-meta z-function-call z-arguments z-python"><span class="z-punctuation z-section z-arguments z-begin z-python">(</span><span class="z-meta z-qualified-name z-python"><span class="z-meta z-generic-name z-python">stack_pointer</span></span><span class="z-punctuation z-separator z-arguments z-python">,</span> <span class="z-constant z-numeric z-integer z-decimal z-python">8</span><span class="z-punctuation z-section z-arguments z-end z-python">)</span></span>
</span><span class="z-source z-python">                <span class="z-comment z-line z-number-sign z-python"><span class="z-punctuation z-definition z-comment z-python">#</span> Imitate a `pop` by consuming data from the stack
</span></span><span class="z-source z-python">                <span class="z-meta z-qualified-name z-python"><span class="z-meta z-generic-name z-python">stack_pointer</span></span> <span class="z-keyword z-operator z-assignment z-augmented z-python">+=</span> <span class="z-constant z-numeric z-integer z-decimal z-python">8</span>
</span><span class="z-source z-python">
</span><span class="z-source z-python">                <span class="z-comment z-line z-number-sign z-python"><span class="z-punctuation z-definition z-comment z-python">#</span> In theory we could have pops of various lengths, not just full 64 bit registers,
</span></span><span class="z-source z-python">                <span class="z-comment z-line z-number-sign z-python"><span class="z-punctuation z-definition z-comment z-python">#</span> but in practice only pops of 64 bit length were used
</span></span><span class="z-source z-python">                <span class="z-meta z-qualified-name z-python"><span class="z-meta z-generic-name z-python">val</span></span> <span class="z-keyword z-operator z-assignment z-python">=</span> <span class="z-meta z-function-call z-python"><span class="z-meta z-qualified-name z-python"><span class="z-variable z-function z-python"><span class="z-meta z-generic-name z-python">u64</span></span></span></span><span class="z-meta z-function-call z-arguments z-python"><span class="z-punctuation z-section z-arguments z-begin z-python">(</span><span class="z-meta z-qualified-name z-python"><span class="z-meta z-generic-name z-python">data</span></span><span class="z-punctuation z-section z-arguments z-end z-python">)</span></span>
</span><span class="z-source z-python">
</span><span class="z-source z-python">                <span class="z-meta z-function-call z-python"><span class="z-meta z-qualified-name z-python"><span class="z-variable z-function z-python"><span class="z-support z-function z-builtin z-python">print</span></span></span></span><span class="z-meta z-function-call z-arguments z-python"><span class="z-punctuation z-section z-arguments z-begin z-python">(</span><span class="z-storage z-type z-string z-python">f</span><span class="z-meta z-string z-interpolated z-python"><span class="z-string z-quoted z-single z-python"><span class="z-punctuation z-definition z-string z-begin z-python">'</span></span></span><span class="z-meta z-string z-interpolated z-python"><span class="z-string z-quoted z-single z-python">0x</span><span class="z-meta z-interpolation z-python"><span class="z-punctuation z-section z-interpolation z-begin z-python">{</span><span class="z-source z-python z-embedded"><span class="z-meta z-qualified-name z-python"><span class="z-meta z-generic-name z-python">instr</span><span class="z-punctuation z-accessor z-dot z-python">.</span><span class="z-meta z-generic-name z-python">ip</span></span></span><span class="z-meta z-format-spec z-python"><span class="z-constant z-other z-format-spec z-python">:06x</span></span></span><span class="z-meta z-interpolation z-python"><span class="z-punctuation z-section z-interpolation z-end z-python">}</span></span><span class="z-string z-quoted z-single z-python">: </span><span class="z-meta z-interpolation z-python"><span class="z-punctuation z-section z-interpolation z-begin z-python">{</span><span class="z-source z-python z-embedded"><span class="z-meta z-qualified-name z-python"><span class="z-meta z-generic-name z-python">finstr</span></span></span></span><span class="z-meta z-interpolation z-python"><span class="z-punctuation z-section z-interpolation z-end z-python">}</span></span><span class="z-string z-quoted z-single z-python"><span class="z-constant z-character z-escape z-python">\t</span># 0x</span><span class="z-meta z-interpolation z-python"><span class="z-punctuation z-section z-interpolation z-begin z-python">{</span><span class="z-source z-python z-embedded"><span class="z-meta z-qualified-name z-python"><span class="z-meta z-generic-name z-python">val</span></span></span><span class="z-meta z-format-spec z-python"><span class="z-constant z-other z-format-spec z-python">:02x</span></span></span><span class="z-meta z-interpolation z-python"><span class="z-punctuation z-section z-interpolation z-end z-python">}</span></span><span class="z-string z-quoted z-single z-python"><span class="z-punctuation z-definition z-string z-end z-python">'</span></span></span><span class="z-punctuation z-section z-arguments z-end z-python">)</span></span>
</span><span class="z-source z-python">            <span class="z-meta z-statement z-conditional z-elseif z-python"><span class="z-keyword z-control z-conditional z-elseif z-python">elif</span> <span class="z-meta z-qualified-name z-python"><span class="z-meta z-generic-name z-python">instr</span><span class="z-punctuation z-accessor z-dot z-python">.</span><span class="z-meta z-generic-name z-python">mnemonic</span></span> <span class="z-keyword z-operator z-comparison z-python">==</span> <span class="z-meta z-qualified-name z-python"><span class="z-meta z-generic-name z-python">Mnemonic</span><span class="z-punctuation z-accessor z-dot z-python">.</span><span class="z-variable z-other z-constant z-python">RET</span></span><span class="z-punctuation z-section z-block z-conditional z-elseif z-python">:</span></span>
</span><span class="z-source z-python">                <span class="z-meta z-function-call z-python"><span class="z-meta z-qualified-name z-python"><span class="z-variable z-function z-python"><span class="z-support z-function z-builtin z-python">print</span></span></span></span><span class="z-meta z-function-call z-arguments z-python"><span class="z-punctuation z-section z-arguments z-begin z-python">(</span><span class="z-storage z-type z-string z-python">f</span><span class="z-meta z-string z-interpolated z-python"><span class="z-string z-quoted z-single z-python"><span class="z-punctuation z-definition z-string z-begin z-python">'</span></span></span><span class="z-meta z-string z-interpolated z-python"><span class="z-string z-quoted z-single z-python">0x</span><span class="z-meta z-interpolation z-python"><span class="z-punctuation z-section z-interpolation z-begin z-python">{</span><span class="z-source z-python z-embedded"><span class="z-meta z-qualified-name z-python"><span class="z-meta z-generic-name z-python">instr</span><span class="z-punctuation z-accessor z-dot z-python">.</span><span class="z-meta z-generic-name z-python">ip</span></span></span><span class="z-meta z-format-spec z-python"><span class="z-constant z-other z-format-spec z-python">:06x</span></span></span><span class="z-meta z-interpolation z-python"><span class="z-punctuation z-section z-interpolation z-end z-python">}</span></span><span class="z-string z-quoted z-single z-python">: </span><span class="z-meta z-interpolation z-python"><span class="z-punctuation z-section z-interpolation z-begin z-python">{</span><span class="z-source z-python z-embedded"><span class="z-meta z-qualified-name z-python"><span class="z-meta z-generic-name z-python">finstr</span></span></span></span><span class="z-meta z-interpolation z-python"><span class="z-punctuation z-section z-interpolation z-end z-python">}</span></span><span class="z-string z-quoted z-single z-python"><span class="z-constant z-character z-escape z-python">\t</span><span class="z-constant z-character z-escape z-python">\t</span># rsp = 0x</span><span class="z-meta z-interpolation z-python"><span class="z-punctuation z-section z-interpolation z-begin z-python">{</span><span class="z-source z-python z-embedded"><span class="z-meta z-qualified-name z-python"><span class="z-meta z-generic-name z-python">stack_pointer</span></span></span><span class="z-meta z-format-spec z-python"><span class="z-constant z-other z-format-spec z-python">:02x</span></span></span><span class="z-meta z-interpolation z-python"><span class="z-punctuation z-section z-interpolation z-end z-python">}</span></span><span class="z-string z-quoted z-single z-python"><span class="z-punctuation z-definition z-string z-end z-python">'</span></span></span><span class="z-punctuation z-section z-arguments z-end z-python">)</span></span>
</span><span class="z-source z-python">                <span class="z-keyword z-control z-flow z-break z-python">break</span>
</span><span class="z-source z-python">            <span class="z-meta z-statement z-conditional z-else z-python"><span class="z-keyword z-control z-conditional z-else z-python">else</span><span class="z-punctuation z-section z-block z-conditional z-else z-python">:</span></span>
</span><span class="z-source z-python">                <span class="z-meta z-function-call z-python"><span class="z-meta z-qualified-name z-python"><span class="z-variable z-function z-python"><span class="z-support z-function z-builtin z-python">print</span></span></span></span><span class="z-meta z-function-call z-arguments z-python"><span class="z-punctuation z-section z-arguments z-begin z-python">(</span><span class="z-storage z-type z-string z-python">f</span><span class="z-meta z-string z-interpolated z-python"><span class="z-string z-quoted z-single z-python"><span class="z-punctuation z-definition z-string z-begin z-python">'</span></span></span><span class="z-meta z-string z-interpolated z-python"><span class="z-string z-quoted z-single z-python">0x</span><span class="z-meta z-interpolation z-python"><span class="z-punctuation z-section z-interpolation z-begin z-python">{</span><span class="z-source z-python z-embedded"><span class="z-meta z-qualified-name z-python"><span class="z-meta z-generic-name z-python">instr</span><span class="z-punctuation z-accessor z-dot z-python">.</span><span class="z-meta z-generic-name z-python">ip</span></span></span><span class="z-meta z-format-spec z-python"><span class="z-constant z-other z-format-spec z-python">:06x</span></span></span><span class="z-meta z-interpolation z-python"><span class="z-punctuation z-section z-interpolation z-end z-python">}</span></span><span class="z-string z-quoted z-single z-python">: </span><span class="z-meta z-interpolation z-python"><span class="z-punctuation z-section z-interpolation z-begin z-python">{</span><span class="z-source z-python z-embedded"><span class="z-meta z-qualified-name z-python"><span class="z-meta z-generic-name z-python">finstr</span></span></span></span><span class="z-meta z-interpolation z-python"><span class="z-punctuation z-section z-interpolation z-end z-python">}</span></span><span class="z-string z-quoted z-single z-python"><span class="z-punctuation z-definition z-string z-end z-python">'</span></span></span><span class="z-punctuation z-section z-arguments z-end z-python">)</span></span>
</span><span class="z-source z-python">
</span><span class="z-source z-python">
</span><span class="z-source z-python"><span class="z-meta z-statement z-conditional z-if z-python"><span class="z-keyword z-control z-conditional z-if z-python">if</span> <span class="z-meta z-qualified-name z-python"><span class="z-support z-variable z-magic z-python">__name__</span></span> <span class="z-keyword z-operator z-comparison z-python">==</span> <span class="z-meta z-string z-python"><span class="z-string z-quoted z-double z-python"><span class="z-punctuation z-definition z-string z-begin z-python">"</span></span></span><span class="z-meta z-string z-python"><span class="z-string z-quoted z-double z-python">__main__<span class="z-punctuation z-definition z-string z-end z-python">"</span></span></span><span class="z-punctuation z-section z-block z-conditional z-if z-python">:</span></span>
</span><span class="z-source z-python">    <span class="z-meta z-function-call z-python"><span class="z-meta z-qualified-name z-python"><span class="z-variable z-function z-python"><span class="z-meta z-generic-name z-python">main</span></span></span></span><span class="z-meta z-function-call z-arguments z-python"><span class="z-punctuation z-section z-arguments z-begin z-python">(</span><span class="z-punctuation z-section z-arguments z-end z-python">)</span></span>
</span></code></pre><p>The basic implementation is as follows:<ul><li>Read the initial stack pointer value from the symbol <code>data</code> in the binary<li>Do the following in a loop: <ul><li>Read the return address from the stack pointer, consuming 8 bytes from the "stack"<li>Read the instruction data for the gadget referenced by the return pointer<li>Decompile the instruction data, printing the instructions, with a couple of special cases: <ul><li>If the instruction is invalid, terminate the loop<li>If the instruction is <code>pop</code>, read 8 bytes from the "stack" and include the popped value alongside the affected register<li>If the instruction is <code>ret</code>, stop interpreting instructions from the gadgets</ul></ul></ul><p>The output of this program is something like the following (truncated to show the same block from the stack data listed above):<pre class=z-code><code><span class="z-text z-plain">0x450ec7: pop %rax	# 0x65
</span><span class="z-text z-plain">0x450ec8: ret		# rsp = 0x4c5110
</span><span class="z-text z-plain">0x401eef: pop %rdi	# 0x00
</span><span class="z-text z-plain">0x401ef0: ret		# rsp = 0x4c5120
</span><span class="z-text z-plain">0x409f1e: pop %rsi	# 0x01
</span><span class="z-text z-plain">0x409f1f: ret		# rsp = 0x4c5130
</span><span class="z-text z-plain">0x458142: pop %rdx	# 0x00
</span><span class="z-text z-plain">0x458143: ret		# rsp = 0x4c5140
</span><span class="z-text z-plain">0x41aab6: syscall
</span><span class="z-text z-plain">0x41aab8: ret		# rsp = 0x4c5148
</span><span class="z-text z-plain">0x451fe0: mov %rax, %rdi
</span><span class="z-text z-plain">0x451fe3: ret		# rsp = 0x4c5150
</span><span class="z-text z-plain">0x450ec7: pop %rax	# 0x1198
</span><span class="z-text z-plain">0x450ec8: ret		# rsp = 0x4c5160
</span><span class="z-text z-plain">0x452000: mov %rax, %rsi
</span><span class="z-text z-plain">0x452003: xor %rbx, %rbx
</span><span class="z-text z-plain">0x452006: test %rdi, %rdi
</span><span class="z-text z-plain">0x452009: cmovs %rsi, %rbx
</span><span class="z-text z-plain">0x45200d: add %rbx, %rsp
</span><span class="z-text z-plain">0x452010: ret		# rsp = 0x4c5168
</span><span class="z-text z-plain">...
</span></code></pre><p>This gives a good example of how the program flow works. By using <code>pop</code> instructions, the values of each register can be modified by using the data on the stack. Comparing this with the raw stack data, you can see the addresses on the left correlate to the return addresses in the stack data, as well as the comments indicating register assignments matching up with the data on the stack immediately following the return pointer to that gadget.<p>This particular block calls the <code>ptrace</code><sup class=footnote-reference><a href=#ptrace>2</a></sup> system call, with the request <code>PTRACE_TRACEME</code>. The value of <code>rax</code> is the system call number, and there is a good reference for the register values for specific system calls at <a rel="nofollow noreferrer" href=https://x64.syscall.sh/>https://x64.syscall.sh/</a>.<p>There is another really interesting thing about this code, in that effectively performs a conditional jump, even though there are no <code>jmp</code>/<code>jcc</code> instructions present. After the system call, its return value is stored in <code>rdi</code>, and an offset of <code>0x1198</code> is stored in <code>rax</code>. The code at <code>0x452000</code> zeroes the value in <code>rbx</code>, tests the value in <code>rdi</code> (the return value of <code>ptrace</code>) and if the sign bit is set, sets the value of <code>rbx</code> to be the offset. The instruction <code>add %rbx, %rsp</code> is then either <code>add $0, %rsp</code> (a no-op) or <code>addr $0x1198, %rsp</code>, which is effectively a jump, given the next instructions are determined by the value on the stack. The last <code>ret</code> has a comment listing its unmodified stack pointer address - this is the next gadget address if the condition didn't match. If the sign bit was set and <code>cmovs</code> set the value of <code>rbx</code> to the offset <code>0x1198</code>, then the next gadget address would be <code>0x4c5168 + 0x1198 = 0x4c6300</code>. The instructions executed on this branch can be found by finding the <code>ret</code> whose <code>rsp</code> value is <code>0x4c6300</code>.<p>This address has the following breakdown in the program output:<pre class=z-code><code><span class="z-text z-plain">0x450ec7: pop %rax	# 0x706f4e6d31335b1b
</span><span class="z-text z-plain">0x450ec8: ret		# rsp = 0x4c6310
</span><span class="z-text z-plain">0x458142: pop %rdx	# 0x4c57e8
</span><span class="z-text z-plain">0x458143: ret		# rsp = 0x4c6320
</span><span class="z-text z-plain">0x419ad8: mov %rax, (%rdx)
</span><span class="z-text z-plain">0x419adb: ret		# rsp = 0x4c6328
</span><span class="z-text z-plain">0x450ec7: pop %rax	# 0xa6d305b1b65
</span><span class="z-text z-plain">0x450ec8: ret		# rsp = 0x4c6338
</span><span class="z-text z-plain">0x458142: pop %rdx	# 0x4c57f0
</span><span class="z-text z-plain">0x458143: ret		# rsp = 0x4c6348
</span><span class="z-text z-plain">0x419ad8: mov %rax, (%rdx)
</span><span class="z-text z-plain">0x419adb: ret		# rsp = 0x4c6350
</span><span class="z-text z-plain">0x450ec7: pop %rax	# 0x01
</span><span class="z-text z-plain">0x450ec8: ret		# rsp = 0x4c6360
</span><span class="z-text z-plain">0x401eef: pop %rdi	# 0x01
</span><span class="z-text z-plain">0x401ef0: ret		# rsp = 0x4c6370
</span><span class="z-text z-plain">0x409f1e: pop %rsi	# 0x4c57e8
</span><span class="z-text z-plain">0x409f1f: ret		# rsp = 0x4c6380
</span><span class="z-text z-plain">0x458142: pop %rdx	# 0x0e
</span><span class="z-text z-plain">0x458143: ret		# rsp = 0x4c6390
</span><span class="z-text z-plain">0x41aab6: syscall
</span><span class="z-text z-plain">0x41aab8: ret		# rsp = 0x4c6398
</span><span class="z-text z-plain">0x450ec7: pop %rax	# 0x3c
</span><span class="z-text z-plain">0x450ec8: ret		# rsp = 0x4c63a8
</span><span class="z-text z-plain">0x401eef: pop %rdi	# 0x01
</span><span class="z-text z-plain">0x401ef0: ret		# rsp = 0x4c63b8
</span><span class="z-text z-plain">0x41aab6: syscall
</span><span class="z-text z-plain">0x41aab8: ret		# rsp = 0x4c63c0
</span></code></pre><p>This stores a string at <code>0x4c57e8</code>, then calls the system call <code>write</code> to write the string to standard output (file descriptor 1), and finally calls the system call <code>exit</code> with status <code>1</code> (failure). In summary it is pretty close to the following:<pre class="language-c z-code" data-lang=c><code class=language-c data-lang=c><span class="z-source z-c"><span class="z-comment z-line z-double-slash z-c"><span class="z-punctuation z-definition z-comment z-c">//</span> ANSI control sequences to set colour to red before text, reset after
</span></span><span class="z-source z-c"><span class="z-comment z-line z-double-slash z-c"><span class="z-punctuation z-definition z-comment z-c">//</span> Prints the text "Nope" in red to the terminal
</span></span><span class="z-source z-c"><span class="z-meta z-function-call z-c"><span class="z-variable z-function z-c">puts</span><span class="z-meta z-group z-c"><span class="z-punctuation z-section z-group z-begin z-c">(</span></span></span><span class="z-meta z-function-call z-c"><span class="z-meta z-group z-c"><span class="z-string z-quoted z-double z-c"><span class="z-punctuation z-definition z-string z-begin z-c">"</span><span class="z-constant z-character z-escape z-c">\x1b</span>[31mNope<span class="z-constant z-character z-escape z-c">\x1b</span>[0m<span class="z-punctuation z-definition z-string z-end z-c">"</span></span></span><span class="z-meta z-group z-c"><span class="z-punctuation z-section z-group z-end z-c">)</span></span></span><span class="z-punctuation z-terminator z-c">;</span>
</span><span class="z-source z-c"><span class="z-meta z-function-call z-c"><span class="z-variable z-function z-c">exit</span><span class="z-meta z-group z-c"><span class="z-punctuation z-section z-group z-begin z-c">(</span></span></span><span class="z-meta z-function-call z-c"><span class="z-meta z-group z-c"><span class="z-constant z-numeric z-integer z-decimal z-c">1</span></span><span class="z-meta z-group z-c"><span class="z-punctuation z-section z-group z-end z-c">)</span></span></span><span class="z-punctuation z-terminator z-c">;</span>
</span></code></pre><p>This makes it pretty clear that any jump to this address is going to be an indicator of invalid input or state.<h2 id=finding-the-flag>Finding the Flag</h2><p>Now we understand the basic operation of the ROP chain, including the potential for conditional jumps, we need to figure out what the correct flag input should be. Thankfully, the process applied here is very repetitive, so not every instruction needs to be read and understood!<p>The basic flag validation block to process a single character looks like the following:<pre class=z-code><code><span class="z-text z-plain">0x401eef: pop %rdi	# 0x4c7820
</span><span class="z-text z-plain">0x401ef0: ret		# rsp = 0x4c5188
</span><span class="z-text z-plain">0x450ec7: pop %rax	# 0x19
</span><span class="z-text z-plain">0x450ec8: ret		# rsp = 0x4c5198
</span><span class="z-text z-plain">0x451ff0: add %rax, %rdi
</span><span class="z-text z-plain">0x451ff3: ret		# rsp = 0x4c51a0
</span><span class="z-text z-plain">0x451fe8: mov %rdi, %rax
</span><span class="z-text z-plain">0x451feb: ret		# rsp = 0x4c51a8
</span><span class="z-text z-plain">0x45202f: movzbq (%rax), %rax
</span><span class="z-text z-plain">0x452033: ret		# rsp = 0x4c51b0
</span><span class="z-text z-plain">0x451fe0: mov %rax, %rdi
</span><span class="z-text z-plain">0x451fe3: ret		# rsp = 0x4c51b8
</span><span class="z-text z-plain">0x450ec7: pop %rax	# 0x19
</span><span class="z-text z-plain">0x450ec8: ret		# rsp = 0x4c51c8
</span><span class="z-text z-plain">0x451ff0: add %rax, %rdi
</span><span class="z-text z-plain">0x451ff3: ret		# rsp = 0x4c51d0
</span><span class="z-text z-plain">0x450ec7: pop %rax	# 0x05
</span><span class="z-text z-plain">0x450ec8: ret		# rsp = 0x4c51e0
</span><span class="z-text z-plain">0x451ff8: xor %rax, %rdi
</span><span class="z-text z-plain">0x451ffb: ret		# rsp = 0x4c51e8
</span><span class="z-text z-plain">0x450ec7: pop %rax	# 0x6e
</span><span class="z-text z-plain">0x450ec8: ret		# rsp = 0x4c51f8
</span><span class="z-text z-plain">0x451fec: sub %rax, %rdi
</span><span class="z-text z-plain">0x451fef: ret		# rsp = 0x4c5200
</span><span class="z-text z-plain">0x452011: mov $1, %esi
</span><span class="z-text z-plain">0x452016: test %rdi, %rdi
</span><span class="z-text z-plain">0x452019: cmovne %rsi, %rdx
</span><span class="z-text z-plain">0x45201d: ret		# rsp = 0x4c5208
</span></code></pre><p>First, it loads the address of <code>buf</code> (the user input) into <code>rdi</code>, then it adds <code>0x19</code> to the address, then it loads a single byte from the address into <code>rax</code>, and moves it into <code>rdi</code>. Next, it adds <code>0x19</code> to the character value, xors it with <code>0x05</code>, then subtracts <code>0x6e</code>. Finally, it tests if the value after processing is zero, and if not it sets <code>rdx</code> to <code>1</code>.<p>This pattern repeats with different character indexes and subtraction values until the final test of validity is just to ensure that <code>rdx</code> is zero.<p>By extracting the subtraction value for each offset, the flag input can be generated. The following python script contains all extracted offsets and the value in the final subtraction, then applies the inverse of the transformation to find each character's correct value (note the mapping of <code>0x19</code> to <code>0x6e</code> as demonstrated in the example):<pre class="language-python z-code" data-lang=python><code class=language-python data-lang=python><span class="z-source z-python"><span class="z-comment z-line z-number-sign z-python"><span class="z-punctuation z-definition z-comment z-python">#</span>!/usr/bin/env python3
</span></span><span class="z-source z-python">
</span><span class="z-source z-python"><span class="z-meta z-statement z-import z-python"><span class="z-keyword z-control z-import z-from z-python">from</span></span><span class="z-meta z-statement z-import z-python"><span class="z-meta z-import-source z-python"> <span class="z-meta z-import-path z-python"><span class="z-meta z-import-name z-python">operator</span></span> <span class="z-meta z-statement z-import z-python"><span class="z-keyword z-control z-import z-python">import</span></span></span></span><span class="z-meta z-statement z-import z-python"></span><span class="z-meta z-statement z-import z-python"> <span class="z-meta z-generic-name z-python">xor</span></span>
</span><span class="z-source z-python">
</span><span class="z-source z-python"><span class="z-meta z-qualified-name z-python"><span class="z-meta z-generic-name z-python">sub_vals</span></span> <span class="z-keyword z-operator z-assignment z-python">=</span> <span class="z-meta z-mapping-or-set z-python"><span class="z-punctuation z-section z-mapping-or-set z-begin z-python">{</span>
</span></span><span class="z-source z-python"><span class="z-meta z-mapping-or-set z-python">        <span class="z-constant z-numeric z-integer z-hexadecimal z-python"><span class="z-punctuation z-definition z-numeric z-base z-python">0x</span>00</span></span><span class="z-meta z-mapping z-python"><span class="z-punctuation z-separator z-mapping z-key-value z-python">:</span></span><span class="z-meta z-mapping z-python"> </span><span class="z-meta z-mapping z-value z-python"><span class="z-constant z-numeric z-integer z-hexadecimal z-python"><span class="z-punctuation z-definition z-numeric z-base z-python">0x</span>4d</span></span><span class="z-meta z-mapping z-python"><span class="z-punctuation z-separator z-mapping z-python">,</span>
</span></span><span class="z-source z-python"><span class="z-meta z-mapping z-python">        </span><span class="z-meta z-mapping z-key z-python"><span class="z-constant z-numeric z-integer z-hexadecimal z-python"><span class="z-punctuation z-definition z-numeric z-base z-python">0x</span>01</span></span><span class="z-meta z-mapping z-python"><span class="z-punctuation z-separator z-mapping z-key-value z-python">:</span></span><span class="z-meta z-mapping z-python"> </span><span class="z-meta z-mapping z-value z-python"><span class="z-constant z-numeric z-integer z-hexadecimal z-python"><span class="z-punctuation z-definition z-numeric z-base z-python">0x</span>50</span></span><span class="z-meta z-mapping z-python"><span class="z-punctuation z-separator z-mapping z-python">,</span>
</span></span><span class="z-source z-python"><span class="z-meta z-mapping z-python">        </span><span class="z-meta z-mapping z-key z-python"><span class="z-constant z-numeric z-integer z-hexadecimal z-python"><span class="z-punctuation z-definition z-numeric z-base z-python">0x</span>02</span></span><span class="z-meta z-mapping z-python"><span class="z-punctuation z-separator z-mapping z-key-value z-python">:</span></span><span class="z-meta z-mapping z-python"> </span><span class="z-meta z-mapping z-value z-python"><span class="z-constant z-numeric z-integer z-hexadecimal z-python"><span class="z-punctuation z-definition z-numeric z-base z-python">0x</span>41</span></span><span class="z-meta z-mapping z-python"><span class="z-punctuation z-separator z-mapping z-python">,</span>
</span></span><span class="z-source z-python"><span class="z-meta z-mapping z-python">        </span><span class="z-meta z-mapping z-key z-python"><span class="z-constant z-numeric z-integer z-hexadecimal z-python"><span class="z-punctuation z-definition z-numeric z-base z-python">0x</span>03</span></span><span class="z-meta z-mapping z-python"><span class="z-punctuation z-separator z-mapping z-key-value z-python">:</span></span><span class="z-meta z-mapping z-python"> </span><span class="z-meta z-mapping z-value z-python"><span class="z-constant z-numeric z-integer z-hexadecimal z-python"><span class="z-punctuation z-definition z-numeric z-base z-python">0x</span>7b</span></span><span class="z-meta z-mapping z-python"><span class="z-punctuation z-separator z-mapping z-python">,</span>
</span></span><span class="z-source z-python"><span class="z-meta z-mapping z-python">        </span><span class="z-meta z-mapping z-key z-python"><span class="z-constant z-numeric z-integer z-hexadecimal z-python"><span class="z-punctuation z-definition z-numeric z-base z-python">0x</span>04</span></span><span class="z-meta z-mapping z-python"><span class="z-punctuation z-separator z-mapping z-key-value z-python">:</span></span><span class="z-meta z-mapping z-python"> </span><span class="z-meta z-mapping z-value z-python"><span class="z-constant z-numeric z-integer z-hexadecimal z-python"><span class="z-punctuation z-definition z-numeric z-base z-python">0x</span>5e</span></span><span class="z-meta z-mapping z-python"><span class="z-punctuation z-separator z-mapping z-python">,</span>
</span></span><span class="z-source z-python"><span class="z-meta z-mapping z-python">        </span><span class="z-meta z-mapping z-key z-python"><span class="z-constant z-numeric z-integer z-hexadecimal z-python"><span class="z-punctuation z-definition z-numeric z-base z-python">0x</span>05</span></span><span class="z-meta z-mapping z-python"><span class="z-punctuation z-separator z-mapping z-key-value z-python">:</span></span><span class="z-meta z-mapping z-python"> </span><span class="z-meta z-mapping z-value z-python"><span class="z-constant z-numeric z-integer z-hexadecimal z-python"><span class="z-punctuation z-definition z-numeric z-base z-python">0x</span>3c</span></span><span class="z-meta z-mapping z-python"><span class="z-punctuation z-separator z-mapping z-python">,</span>
</span></span><span class="z-source z-python"><span class="z-meta z-mapping z-python">        </span><span class="z-meta z-mapping z-key z-python"><span class="z-constant z-numeric z-integer z-hexadecimal z-python"><span class="z-punctuation z-definition z-numeric z-base z-python">0x</span>06</span></span><span class="z-meta z-mapping z-python"><span class="z-punctuation z-separator z-mapping z-key-value z-python">:</span></span><span class="z-meta z-mapping z-python"> </span><span class="z-meta z-mapping z-value z-python"><span class="z-constant z-numeric z-integer z-hexadecimal z-python"><span class="z-punctuation z-definition z-numeric z-base z-python">0x</span>6a</span></span><span class="z-meta z-mapping z-python"><span class="z-punctuation z-separator z-mapping z-python">,</span>
</span></span><span class="z-source z-python"><span class="z-meta z-mapping z-python">        </span><span class="z-meta z-mapping z-key z-python"><span class="z-constant z-numeric z-integer z-hexadecimal z-python"><span class="z-punctuation z-definition z-numeric z-base z-python">0x</span>07</span></span><span class="z-meta z-mapping z-python"><span class="z-punctuation z-separator z-mapping z-key-value z-python">:</span></span><span class="z-meta z-mapping z-python"> </span><span class="z-meta z-mapping z-value z-python"><span class="z-constant z-numeric z-integer z-hexadecimal z-python"><span class="z-punctuation z-definition z-numeric z-base z-python">0x</span>5e</span></span><span class="z-meta z-mapping z-python"><span class="z-punctuation z-separator z-mapping z-python">,</span>
</span></span><span class="z-source z-python"><span class="z-meta z-mapping z-python">        </span><span class="z-meta z-mapping z-key z-python"><span class="z-constant z-numeric z-integer z-hexadecimal z-python"><span class="z-punctuation z-definition z-numeric z-base z-python">0x</span>08</span></span><span class="z-meta z-mapping z-python"><span class="z-punctuation z-separator z-mapping z-key-value z-python">:</span></span><span class="z-meta z-mapping z-python"> </span><span class="z-meta z-mapping z-value z-python"><span class="z-constant z-numeric z-integer z-hexadecimal z-python"><span class="z-punctuation z-definition z-numeric z-base z-python">0x</span>62</span></span><span class="z-meta z-mapping z-python"><span class="z-punctuation z-separator z-mapping z-python">,</span>
</span></span><span class="z-source z-python"><span class="z-meta z-mapping z-python">        </span><span class="z-meta z-mapping z-key z-python"><span class="z-constant z-numeric z-integer z-hexadecimal z-python"><span class="z-punctuation z-definition z-numeric z-base z-python">0x</span>09</span></span><span class="z-meta z-mapping z-python"><span class="z-punctuation z-separator z-mapping z-key-value z-python">:</span></span><span class="z-meta z-mapping z-python"> </span><span class="z-meta z-mapping z-value z-python"><span class="z-constant z-numeric z-integer z-hexadecimal z-python"><span class="z-punctuation z-definition z-numeric z-base z-python">0x</span>65</span></span><span class="z-meta z-mapping z-python"><span class="z-punctuation z-separator z-mapping z-python">,</span>
</span></span><span class="z-source z-python"><span class="z-meta z-mapping z-python">        </span><span class="z-meta z-mapping z-key z-python"><span class="z-constant z-numeric z-integer z-hexadecimal z-python"><span class="z-punctuation z-definition z-numeric z-base z-python">0x</span>0a</span></span><span class="z-meta z-mapping z-python"><span class="z-punctuation z-separator z-mapping z-key-value z-python">:</span></span><span class="z-meta z-mapping z-python"> </span><span class="z-meta z-mapping z-value z-python"><span class="z-constant z-numeric z-integer z-hexadecimal z-python"><span class="z-punctuation z-definition z-numeric z-base z-python">0x</span>3b</span></span><span class="z-meta z-mapping z-python"><span class="z-punctuation z-separator z-mapping z-python">,</span>
</span></span><span class="z-source z-python"><span class="z-meta z-mapping z-python">        </span><span class="z-meta z-mapping z-key z-python"><span class="z-constant z-numeric z-integer z-hexadecimal z-python"><span class="z-punctuation z-definition z-numeric z-base z-python">0x</span>0b</span></span><span class="z-meta z-mapping z-python"><span class="z-punctuation z-separator z-mapping z-key-value z-python">:</span></span><span class="z-meta z-mapping z-python"> </span><span class="z-meta z-mapping z-value z-python"><span class="z-constant z-numeric z-integer z-hexadecimal z-python"><span class="z-punctuation z-definition z-numeric z-base z-python">0x</span>5b</span></span><span class="z-meta z-mapping z-python"><span class="z-punctuation z-separator z-mapping z-python">,</span>
</span></span><span class="z-source z-python"><span class="z-meta z-mapping z-python">        </span><span class="z-meta z-mapping z-key z-python"><span class="z-constant z-numeric z-integer z-hexadecimal z-python"><span class="z-punctuation z-definition z-numeric z-base z-python">0x</span>0d</span></span><span class="z-meta z-mapping z-python"><span class="z-punctuation z-separator z-mapping z-key-value z-python">:</span></span><span class="z-meta z-mapping z-python"> </span><span class="z-meta z-mapping z-value z-python"><span class="z-constant z-numeric z-integer z-hexadecimal z-python"><span class="z-punctuation z-definition z-numeric z-base z-python">0x</span>64</span></span><span class="z-meta z-mapping z-python"><span class="z-punctuation z-separator z-mapping z-python">,</span>
</span></span><span class="z-source z-python"><span class="z-meta z-mapping z-python">        </span><span class="z-meta z-mapping z-key z-python"><span class="z-constant z-numeric z-integer z-hexadecimal z-python"><span class="z-punctuation z-definition z-numeric z-base z-python">0x</span>0c</span></span><span class="z-meta z-mapping z-python"><span class="z-punctuation z-separator z-mapping z-key-value z-python">:</span></span><span class="z-meta z-mapping z-python"> </span><span class="z-meta z-mapping z-value z-python"><span class="z-constant z-numeric z-integer z-hexadecimal z-python"><span class="z-punctuation z-definition z-numeric z-base z-python">0x</span>6e</span></span><span class="z-meta z-mapping z-python"><span class="z-punctuation z-separator z-mapping z-python">,</span>
</span></span><span class="z-source z-python"><span class="z-meta z-mapping z-python">        </span><span class="z-meta z-mapping z-key z-python"><span class="z-constant z-numeric z-integer z-hexadecimal z-python"><span class="z-punctuation z-definition z-numeric z-base z-python">0x</span>0e</span></span><span class="z-meta z-mapping z-python"><span class="z-punctuation z-separator z-mapping z-key-value z-python">:</span></span><span class="z-meta z-mapping z-python"> </span><span class="z-meta z-mapping z-value z-python"><span class="z-constant z-numeric z-integer z-hexadecimal z-python"><span class="z-punctuation z-definition z-numeric z-base z-python">0x</span>73</span></span><span class="z-meta z-mapping z-python"><span class="z-punctuation z-separator z-mapping z-python">,</span>
</span></span><span class="z-source z-python"><span class="z-meta z-mapping z-python">        </span><span class="z-meta z-mapping z-key z-python"><span class="z-constant z-numeric z-integer z-hexadecimal z-python"><span class="z-punctuation z-definition z-numeric z-base z-python">0x</span>0f</span></span><span class="z-meta z-mapping z-python"><span class="z-punctuation z-separator z-mapping z-key-value z-python">:</span></span><span class="z-meta z-mapping z-python"> </span><span class="z-meta z-mapping z-value z-python"><span class="z-constant z-numeric z-integer z-hexadecimal z-python"><span class="z-punctuation z-definition z-numeric z-base z-python">0x</span>4a</span></span><span class="z-meta z-mapping z-python"><span class="z-punctuation z-separator z-mapping z-python">,</span>
</span></span><span class="z-source z-python"><span class="z-meta z-mapping z-python">        </span><span class="z-meta z-mapping z-key z-python"><span class="z-constant z-numeric z-integer z-hexadecimal z-python"><span class="z-punctuation z-definition z-numeric z-base z-python">0x</span>10</span></span><span class="z-meta z-mapping z-python"><span class="z-punctuation z-separator z-mapping z-key-value z-python">:</span></span><span class="z-meta z-mapping z-python"> </span><span class="z-meta z-mapping z-value z-python"><span class="z-constant z-numeric z-integer z-hexadecimal z-python"><span class="z-punctuation z-definition z-numeric z-base z-python">0x</span>81</span></span><span class="z-meta z-mapping z-python"><span class="z-punctuation z-separator z-mapping z-python">,</span>
</span></span><span class="z-source z-python"><span class="z-meta z-mapping z-python">        </span><span class="z-meta z-mapping z-key z-python"><span class="z-constant z-numeric z-integer z-hexadecimal z-python"><span class="z-punctuation z-definition z-numeric z-base z-python">0x</span>11</span></span><span class="z-meta z-mapping z-python"><span class="z-punctuation z-separator z-mapping z-key-value z-python">:</span></span><span class="z-meta z-mapping z-python"> </span><span class="z-meta z-mapping z-value z-python"><span class="z-constant z-numeric z-integer z-hexadecimal z-python"><span class="z-punctuation z-definition z-numeric z-base z-python">0x</span>75</span></span><span class="z-meta z-mapping z-python"><span class="z-punctuation z-separator z-mapping z-python">,</span>
</span></span><span class="z-source z-python"><span class="z-meta z-mapping z-python">        </span><span class="z-meta z-mapping z-key z-python"><span class="z-constant z-numeric z-integer z-hexadecimal z-python"><span class="z-punctuation z-definition z-numeric z-base z-python">0x</span>12</span></span><span class="z-meta z-mapping z-python"><span class="z-punctuation z-separator z-mapping z-key-value z-python">:</span></span><span class="z-meta z-mapping z-python"> </span><span class="z-meta z-mapping z-value z-python"><span class="z-constant z-numeric z-integer z-hexadecimal z-python"><span class="z-punctuation z-definition z-numeric z-base z-python">0x</span>67</span></span><span class="z-meta z-mapping z-python"><span class="z-punctuation z-separator z-mapping z-python">,</span>
</span></span><span class="z-source z-python"><span class="z-meta z-mapping z-python">        </span><span class="z-meta z-mapping z-key z-python"><span class="z-constant z-numeric z-integer z-hexadecimal z-python"><span class="z-punctuation z-definition z-numeric z-base z-python">0x</span>13</span></span><span class="z-meta z-mapping z-python"><span class="z-punctuation z-separator z-mapping z-key-value z-python">:</span></span><span class="z-meta z-mapping z-python"> </span><span class="z-meta z-mapping z-value z-python"><span class="z-constant z-numeric z-integer z-hexadecimal z-python"><span class="z-punctuation z-definition z-numeric z-base z-python">0x</span>6f</span></span><span class="z-meta z-mapping z-python"><span class="z-punctuation z-separator z-mapping z-python">,</span>
</span></span><span class="z-source z-python"><span class="z-meta z-mapping z-python">        </span><span class="z-meta z-mapping z-key z-python"><span class="z-constant z-numeric z-integer z-hexadecimal z-python"><span class="z-punctuation z-definition z-numeric z-base z-python">0x</span>14</span></span><span class="z-meta z-mapping z-python"><span class="z-punctuation z-separator z-mapping z-key-value z-python">:</span></span><span class="z-meta z-mapping z-python"> </span><span class="z-meta z-mapping z-value z-python"><span class="z-constant z-numeric z-integer z-hexadecimal z-python"><span class="z-punctuation z-definition z-numeric z-base z-python">0x</span>67</span></span><span class="z-meta z-mapping z-python"><span class="z-punctuation z-separator z-mapping z-python">,</span>
</span></span><span class="z-source z-python"><span class="z-meta z-mapping z-python">        </span><span class="z-meta z-mapping z-key z-python"><span class="z-constant z-numeric z-integer z-hexadecimal z-python"><span class="z-punctuation z-definition z-numeric z-base z-python">0x</span>15</span></span><span class="z-meta z-mapping z-python"><span class="z-punctuation z-separator z-mapping z-key-value z-python">:</span></span><span class="z-meta z-mapping z-python"> </span><span class="z-meta z-mapping z-value z-python"><span class="z-constant z-numeric z-integer z-hexadecimal z-python"><span class="z-punctuation z-definition z-numeric z-base z-python">0x</span>71</span></span><span class="z-meta z-mapping z-python"><span class="z-punctuation z-separator z-mapping z-python">,</span>
</span></span><span class="z-source z-python"><span class="z-meta z-mapping z-python">        </span><span class="z-meta z-mapping z-key z-python"><span class="z-constant z-numeric z-integer z-hexadecimal z-python"><span class="z-punctuation z-definition z-numeric z-base z-python">0x</span>16</span></span><span class="z-meta z-mapping z-python"><span class="z-punctuation z-separator z-mapping z-key-value z-python">:</span></span><span class="z-meta z-mapping z-python"> </span><span class="z-meta z-mapping z-value z-python"><span class="z-constant z-numeric z-integer z-hexadecimal z-python"><span class="z-punctuation z-definition z-numeric z-base z-python">0x</span>43</span></span><span class="z-meta z-mapping z-python"><span class="z-punctuation z-separator z-mapping z-python">,</span>
</span></span><span class="z-source z-python"><span class="z-meta z-mapping z-python">        </span><span class="z-meta z-mapping z-key z-python"><span class="z-constant z-numeric z-integer z-hexadecimal z-python"><span class="z-punctuation z-definition z-numeric z-base z-python">0x</span>17</span></span><span class="z-meta z-mapping z-python"><span class="z-punctuation z-separator z-mapping z-key-value z-python">:</span></span><span class="z-meta z-mapping z-python"> </span><span class="z-meta z-mapping z-value z-python"><span class="z-constant z-numeric z-integer z-hexadecimal z-python"><span class="z-punctuation z-definition z-numeric z-base z-python">0x</span>6c</span></span><span class="z-meta z-mapping z-python"><span class="z-punctuation z-separator z-mapping z-python">,</span>
</span></span><span class="z-source z-python"><span class="z-meta z-mapping z-python">        </span><span class="z-meta z-mapping z-key z-python"><span class="z-constant z-numeric z-integer z-hexadecimal z-python"><span class="z-punctuation z-definition z-numeric z-base z-python">0x</span>18</span></span><span class="z-meta z-mapping z-python"><span class="z-punctuation z-separator z-mapping z-key-value z-python">:</span></span><span class="z-meta z-mapping z-python"> </span><span class="z-meta z-mapping z-value z-python"><span class="z-constant z-numeric z-integer z-hexadecimal z-python"><span class="z-punctuation z-definition z-numeric z-base z-python">0x</span>72</span></span><span class="z-meta z-mapping z-python"><span class="z-punctuation z-separator z-mapping z-python">,</span>
</span></span><span class="z-source z-python"><span class="z-meta z-mapping z-python">        </span><span class="z-meta z-mapping z-key z-python"><span class="z-constant z-numeric z-integer z-hexadecimal z-python"><span class="z-punctuation z-definition z-numeric z-base z-python">0x</span>19</span></span><span class="z-meta z-mapping z-python"><span class="z-punctuation z-separator z-mapping z-key-value z-python">:</span></span><span class="z-meta z-mapping z-python"> </span><span class="z-meta z-mapping z-value z-python"><span class="z-constant z-numeric z-integer z-hexadecimal z-python"><span class="z-punctuation z-definition z-numeric z-base z-python">0x</span>6e</span></span><span class="z-meta z-mapping z-python"><span class="z-punctuation z-separator z-mapping z-python">,</span>
</span></span><span class="z-source z-python"><span class="z-meta z-mapping z-python">        </span><span class="z-meta z-mapping z-key z-python"><span class="z-constant z-numeric z-integer z-hexadecimal z-python"><span class="z-punctuation z-definition z-numeric z-base z-python">0x</span>1a</span></span><span class="z-meta z-mapping z-python"><span class="z-punctuation z-separator z-mapping z-key-value z-python">:</span></span><span class="z-meta z-mapping z-python"> </span><span class="z-meta z-mapping z-value z-python"><span class="z-constant z-numeric z-integer z-hexadecimal z-python"><span class="z-punctuation z-definition z-numeric z-base z-python">0x</span>48</span></span><span class="z-meta z-mapping z-python"><span class="z-punctuation z-separator z-mapping z-python">,</span>
</span></span><span class="z-source z-python"><span class="z-meta z-mapping z-python">        </span><span class="z-meta z-mapping z-key z-python"><span class="z-constant z-numeric z-integer z-hexadecimal z-python"><span class="z-punctuation z-definition z-numeric z-base z-python">0x</span>1b</span></span><span class="z-meta z-mapping z-python"><span class="z-punctuation z-separator z-mapping z-key-value z-python">:</span></span><span class="z-meta z-mapping z-python"> </span><span class="z-meta z-mapping z-value z-python"><span class="z-constant z-numeric z-integer z-hexadecimal z-python"><span class="z-punctuation z-definition z-numeric z-base z-python">0x</span>74</span></span><span class="z-meta z-mapping z-python"><span class="z-punctuation z-separator z-mapping z-python">,</span>
</span></span><span class="z-source z-python"><span class="z-meta z-mapping z-python">        </span><span class="z-meta z-mapping z-key z-python"><span class="z-constant z-numeric z-integer z-hexadecimal z-python"><span class="z-punctuation z-definition z-numeric z-base z-python">0x</span>1c</span></span><span class="z-meta z-mapping z-python"><span class="z-punctuation z-separator z-mapping z-key-value z-python">:</span></span><span class="z-meta z-mapping z-python"> </span><span class="z-meta z-mapping z-value z-python"><span class="z-constant z-numeric z-integer z-hexadecimal z-python"><span class="z-punctuation z-definition z-numeric z-base z-python">0x</span>9c</span></span><span class="z-meta z-mapping z-python"><span class="z-punctuation z-separator z-mapping z-python">,</span>
</span></span><span class="z-source z-python"><span class="z-meta z-mapping z-python"><span class="z-punctuation z-section z-mapping z-end z-python">}</span></span>
</span><span class="z-source z-python">
</span><span class="z-source z-python"><span class="z-meta z-qualified-name z-python"><span class="z-meta z-generic-name z-python">flag_bytes</span></span> <span class="z-keyword z-operator z-assignment z-python">=</span> <span class="z-meta z-sequence z-list z-python"><span class="z-punctuation z-section z-sequence z-begin z-python">[</span><span class="z-constant z-numeric z-integer z-decimal z-python">0</span><span class="z-punctuation z-section z-sequence z-end z-python">]</span></span><span class="z-keyword z-operator z-arithmetic z-python">*</span><span class="z-constant z-numeric z-integer z-hexadecimal z-python"><span class="z-punctuation z-definition z-numeric z-base z-python">0x</span>1d</span>
</span><span class="z-source z-python">
</span><span class="z-source z-python"><span class="z-meta z-statement z-loop z-for z-python"><span class="z-keyword z-control z-loop z-for z-python">for</span> <span class="z-meta z-generic-name z-python">i</span> <span class="z-keyword z-control z-loop z-for z-in z-python">in</span></span><span class="z-meta z-statement z-loop z-for z-python"> <span class="z-meta z-function-call z-python"><span class="z-meta z-qualified-name z-python"><span class="z-variable z-function z-python"><span class="z-support z-function z-builtin z-python">range</span></span></span></span><span class="z-meta z-function-call z-arguments z-python"><span class="z-punctuation z-section z-arguments z-begin z-python">(</span><span class="z-constant z-numeric z-integer z-hexadecimal z-python"><span class="z-punctuation z-definition z-numeric z-base z-python">0x</span>1d</span><span class="z-punctuation z-section z-arguments z-end z-python">)</span></span></span><span class="z-meta z-statement z-loop z-for z-python"><span class="z-punctuation z-section z-block z-loop z-for z-python">:</span></span>
</span><span class="z-source z-python">    <span class="z-meta z-item-access z-python"><span class="z-meta z-qualified-name z-python"><span class="z-meta z-generic-name z-python">flag_bytes</span></span></span><span class="z-meta z-item-access z-python"><span class="z-punctuation z-section z-brackets z-begin z-python">[</span></span><span class="z-meta z-item-access z-arguments z-python"><span class="z-meta z-qualified-name z-python"><span class="z-meta z-generic-name z-python">i</span></span></span><span class="z-meta z-item-access z-python"><span class="z-punctuation z-section z-brackets z-end z-python">]</span></span> <span class="z-keyword z-operator z-assignment z-python">=</span> <span class="z-meta z-function-call z-python"><span class="z-meta z-qualified-name z-python"><span class="z-variable z-function z-python"><span class="z-meta z-generic-name z-python">xor</span></span></span></span><span class="z-meta z-function-call z-arguments z-python"><span class="z-punctuation z-section z-arguments z-begin z-python">(</span><span class="z-meta z-item-access z-python"><span class="z-meta z-qualified-name z-python"><span class="z-meta z-generic-name z-python">sub_vals</span></span></span><span class="z-meta z-item-access z-python"><span class="z-punctuation z-section z-brackets z-begin z-python">[</span></span><span class="z-meta z-item-access z-arguments z-python"><span class="z-meta z-qualified-name z-python"><span class="z-meta z-generic-name z-python">i</span></span></span><span class="z-meta z-item-access z-python"><span class="z-punctuation z-section z-brackets z-end z-python">]</span></span><span class="z-punctuation z-separator z-arguments z-python">,</span> <span class="z-constant z-numeric z-integer z-hexadecimal z-python"><span class="z-punctuation z-definition z-numeric z-base z-python">0x</span>05</span><span class="z-punctuation z-section z-arguments z-end z-python">)</span></span> <span class="z-keyword z-operator z-arithmetic z-python">-</span> <span class="z-meta z-qualified-name z-python"><span class="z-meta z-generic-name z-python">i</span></span>
</span><span class="z-source z-python">
</span><span class="z-source z-python"><span class="z-meta z-qualified-name z-python"><span class="z-meta z-generic-name z-python">flag</span></span> <span class="z-keyword z-operator z-assignment z-python">=</span> <span class="z-meta z-string z-python"><span class="z-string z-quoted z-single z-python"><span class="z-punctuation z-definition z-string z-begin z-python">'</span></span></span><span class="z-meta z-string z-python"><span class="z-string z-quoted z-single z-python"><span class="z-punctuation z-definition z-string z-end z-python">'</span></span></span><span class="z-meta z-function-call z-python"><span class="z-meta z-qualified-name z-python"><span class="z-punctuation z-accessor z-dot z-python">.</span></span><span class="z-meta z-qualified-name z-python"><span class="z-variable z-function z-python"><span class="z-meta z-generic-name z-python">join</span></span></span></span><span class="z-meta z-function-call z-arguments z-python"><span class="z-punctuation z-section z-arguments z-begin z-python">(</span><span class="z-meta z-sequence z-list z-python"><span class="z-punctuation z-section z-sequence z-begin z-python">[</span><span class="z-meta z-function-call z-python"><span class="z-meta z-qualified-name z-python"><span class="z-variable z-function z-python"><span class="z-support z-function z-builtin z-python">chr</span></span></span></span><span class="z-meta z-function-call z-arguments z-python"><span class="z-punctuation z-section z-arguments z-begin z-python">(</span><span class="z-meta z-qualified-name z-python"><span class="z-meta z-generic-name z-python">x</span></span><span class="z-punctuation z-section z-arguments z-end z-python">)</span></span> <span class="z-meta z-expression z-generator z-python"><span class="z-keyword z-control z-loop z-for z-generator z-python">for</span> <span class="z-meta z-generic-name z-python">x</span> <span class="z-keyword z-control z-loop z-for z-in z-python">in</span></span> <span class="z-meta z-qualified-name z-python"><span class="z-meta z-generic-name z-python">flag_bytes</span></span><span class="z-punctuation z-section z-sequence z-end z-python">]</span></span><span class="z-punctuation z-section z-arguments z-end z-python">)</span></span>
</span><span class="z-source z-python"><span class="z-meta z-function-call z-python"><span class="z-meta z-qualified-name z-python"><span class="z-variable z-function z-python"><span class="z-support z-function z-builtin z-python">print</span></span></span></span><span class="z-meta z-function-call z-arguments z-python"><span class="z-punctuation z-section z-arguments z-begin z-python">(</span><span class="z-meta z-qualified-name z-python"><span class="z-meta z-generic-name z-python">flag</span></span><span class="z-punctuation z-section z-arguments z-end z-python">)</span></span>
</span></code></pre><p>Running this will output the correct flag input.<div class=footnote-definition id=rop><sup class=footnote-definition-label>1</sup><p><a rel="nofollow noreferrer" href=https://en.wikipedia.org/wiki/Return-oriented_programming>https://en.wikipedia.org/wiki/Return-oriented_programming</a></div><div class=footnote-definition id=ptrace><sup class=footnote-definition-label>2</sup><p><a rel="nofollow noreferrer" href=https://www.man7.org/linux/man-pages/man2/ptrace.2.html>https://www.man7.org/linux/man-pages/man2/ptrace.2.html</a></div></main></div>